{
    "collab_server" : "",
    "contents" : "###packages\nlibrary(plotly)\nlibrary(RMySQL)\nlibrary(formattable)\n\n#Connection to database\n\nUSER_NAME = '';\nPASSWORD = '';\n\nmydb = dbConnect(MySQL(), user=USER_NAME, password=PASSWORD, dbname='dp3')\n\n\n#income\nincomeRes = dbSendQuery(mydb, \"select DISTRICT_CODE, REF_DATE, SUM(AVERAGE_INCOME_TOTAL) from WirtschaftWien where REF_DATE >= '2002-01-01' group by DISTRICT_CODE, REF_DATE;\")\nincomeTotal = fetch(incomeRes, n=-1)\n\n#population\npopulationRes = dbSendQuery(mydb, \"select SUM(POP_TOTAL) from BevoelkerungWien where REF_DATE >= '2003-01-01' group by DISTRICT_CODE, REF_DATE;\")\npopulationTotal = fetch(populationRes, n=-1)\n\n\n#create matrix from data\n\nincome = unlist(incomeTotal, use.names = FALSE)\npopulation = unlist(populationTotal, use.names = FALSE)\n\nResult = matrix(c(income, population), nrow = length(population), ncol = 4)\ncolnames(Result) <- c(\"District\", \"Date\", \"Average_Income\", \"Population\")\nwrite.csv(Result, file = \"ResultData.csv\",row.names=FALSE)\n\n\n###### statistics ######\n\n#mean income per district over the years\nmeanIncomePerDistrictRes = dbSendQuery(mydb, \"select AVG(AVERAGE_INCOME_TOTAL) from WirtschaftWien group by DISTRICT_CODE;\")\nmeanIncomePerDistrict = fetch(meanIncomePerDistrictRes, n=-1)\n\nmeanIncome = unlist(meanIncomePerDistrict, use.names = FALSE)*1000\n\n#mean population per district over the years\nmeanPopulationPerDistrictRes = dbSendQuery(mydb, \"select AVG(POP_TOTAL) from BevoelkerungWien where REF_DATE >= '2003-01-01' group by DISTRICT_CODE;\")\nmeanPopulationPerDistrict = fetch(meanPopulationPerDistrictRes, n=-1)\n\nmeanPopulation = unlist(meanPopulationPerDistrict, use.names = FALSE)\n\n\n#highest and lowest incomes/district over the years\nincomeOverYearFirstDistrict = unlist(as.numeric(Result[1:13,3]))\nincomeOverYear15District = as.numeric(Result[183:195,3])\n\n#highest and lowest populations/district over the years\npopulationOverYearFirstDistrict = as.numeric(Result[1:13,4])\npopulationOverYear15District = as.numeric(Result[183:195,4])\n\n#how did the income change from 2002 compared to 2014(in %) in district 1\nincomeChangeFirstDistrict = round((incomeOverYearFirstDistrict[13]-incomeOverYearFirstDistrict[1])/incomeOverYearFirstDistrict[1] * 100, digits = 2)\n\n#how did the income change from 2002 compared to 2014(in %) in district 15\nincomeChange15District = round((incomeOverYear15District[13]-incomeOverYear15District[1])/incomeOverYear15District[1] * 100, digits = 2)\n\n#how did the population change from 2002 compared to 2014(in %) in district 1\npopulationChangeFirstDistrict = round((populationOverYearFirstDistrict[13]-populationOverYearFirstDistrict[1])/populationOverYearFirstDistrict[1] * 100, digits = 2)\n\n#how did the population change from 2002 compared to 2014(in %) in district 15\npopulationChange15District =round((populationOverYear15District[13]-populationOverYear15District[1])/populationOverYear15District[1] * 100, digits = 2)\n\n\n#######plotting#######\n\n\n\n#Mean income and population throughout the districts\nDistricts = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23)\ndata = data.frame(Districts, meanIncome, meanPopulation)\n\np = plot_ly(data, x = ~Districts, y = ~meanPopulation, type = 'bar', name = 'Population') %>%\n  add_trace(y = ~meanIncome, name = 'Income') %>%\n  layout(yaxis = list(title = ''), barmode = 'group')\n\n##output plot as html file\nhtmlwidgets::saveWidget(as_widget(p), \"meanIncomeMeanPopulation.html\")\n\nyears = c(2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014)\n\ndataMeanIncome = data.frame(years, incomeOverYearFirstDistrict, incomeOverYear15District)\ndataMeanPopulation = data.frame(years, populationOverYearFirstDistrict, populationOverYear15District)\n\n#Income comparison of first and 15 district\np1 = plot_ly(dataMeanIncome, x=~years, y=~incomeOverYearFirstDistrict, name=paste(\"Income change in first district:\", incomeChangeFirstDistrict,\"%\", sep = \" \"), type = 'scatter', mode = 'lines')%>%\n  add_trace(y = ~incomeOverYear15District, name = paste('Income change in 15 district:', incomeChange15District,\"%\", sep=\" \"), mode = 'lines+markers')%>%\n  layout(title = 'Income comparison of first and 15 district',\n         yaxis = list(title = 'Income in 1000'),\n         xaxis = list(title = 'Years'))\n\n##output plot as html file\nhtmlwidgets::saveWidget(as_widget(p1), \"incomeComparison.html\")\n\n#Population comparison of first and 15 district\np2 = plot_ly(dataMeanPopulation, x=~years, y=~populationOverYearFirstDistrict, name=paste(\"Population change in first district:\", populationChangeFirstDistrict,\"%\", sep = \" \"), type = 'scatter', mode = 'lines')%>%\n  add_trace(y = ~populationOverYear15District, name = paste(\"Population change in 15 district:\", populationChange15District,\"%\", sep = \" \"), mode = 'lines+markers')%>%\n  layout(title = 'Population comparison of first and 15 district',\n         yaxis = list(title = 'Population'),\n         xaxis = list(title = 'Years'))\n\n##output plot as html file\nhtmlwidgets::saveWidget(as_widget(p2), \"populationComparison.html\")\n\n",
    "created" : 1496058488471.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4069020365",
    "id" : "286CA834",
    "lastKnownWriteTime" : 1496578591,
    "last_content_update" : 1496578591,
    "path" : "~/Desktop/DP3/DataScienceUseCase/DP3.R",
    "project_path" : "DP3.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}